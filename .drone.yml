build:
  image: teaci/msys$$arch
  pull: true
  shell: mingw$$arch
  commands:
    - autoreconf -ifv
    - CPPFLAGS='-O3' ./configure
    - make -j$(nproc)
    - make distcheck -j$(nproc)
    - mv libmcfgthread.dll.a  libmcfgthread-new.dll.a
    - gcc test/test.c -lmcfgthread-new -L.
# FIXME: At the moment this crashes on Wine. We must have a REAL Windows to test it.
#    - ./a

notify:
  irc:
    prefix: build
    nick: mcfgthread-cibot
    channel: mcfproj
    server:
      host: chat.freenode.net
      port: 6667

matrix:
  arch:
    - 64
    - 32
